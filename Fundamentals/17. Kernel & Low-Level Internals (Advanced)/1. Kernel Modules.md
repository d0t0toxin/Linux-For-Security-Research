***
**Kernel Modules:** `lsmod`, `modprobe`, `insmod`, `rmmod`, `depmod`, `modinfo`
***
***
# `lsmod` Command in Linux

## Description

`lsmod` is a Linux command used to display the status of modules currently loaded into the Linux kernel. It provides a simple way to view which kernel modules are active and their dependencies.

## Syntax

```
lsmod
```

`lsmod` does not require any arguments or options.

## Output Format

The output of `lsmod` typically contains three columns:

- **Module**: Name of the kernel module
- **Size**: Memory size used by the module (in bytes)
- **Used by**: Number of instances the module is currently used and by which modules

Example:

```
Module                  Size  Used by
snd_hda_intel          45056  3
snd_hda_codec          147456  1 snd_hda_intel
snd_hwdep              16384  1 snd_hda_codec
snd_pcm                98304  2 snd_hda_intel,snd_hda_codec
```

## Description of Columns

- **Module**: Name of the loaded module
- **Size**: Size of the module in memory
- **Used by**: Number of users or dependent modules

## Related Commands

- `modprobe`: Load or remove kernel modules
- `insmod`: Insert a module into the kernel
- `rmmod`: Remove a module from the kernel
- `depmod`: Generate module dependency information

## Examples

### Display all loaded modules

```
lsmod
```

This will display a list of all currently loaded kernel modules.

### Using lsmod with other commands

- Filter output using `grep` to find a specific module:

```
lsmod | grep snd_hda_intel
```

- Combine with `less` for easier reading of long lists:

```
lsmod | less
```

### Check if a module is loaded

To verify if the module `nvidia` is loaded:

```
lsmod | grep nvidia
```

### Counting loaded modules

To count the number of loaded modules:

```
lsmod | wc -l
```

## Notes

- `lsmod` reads information from `/proc/modules`. Therefore, it requires no special options or parameters.
- It is a read-only command and does not modify system settings.

* * *

* * *

# `modprobe` Command in Linux

## Description

`modprobe` is a Linux command used to add or remove kernel modules. It intelligently handles module dependencies, loading dependent modules automatically when needed.

## Syntax

```
modprobe [options] module_name
```

## Options

- `-a, --all`: Insert all modules specified on the command line
    
- `-r, --remove`: Remove a module from the kernel
    
- `-v, --verbose`: Show detailed information about module loading or removal
    
- `-n, --dry-run`: Show what would be done, without actually doing it
    
- `-q, --quiet`: Suppress output messages
    
- `--first-time`: Only insert modules that are not already loaded
    
- `-f, --force`: Force the operation (use with caution)
    
- `--show-depends`: Display module dependencies without loading
    
- `--use-blacklist`: Honor blacklist entries and do not load blacklisted modules
    

## Description of Behavior

- When adding a module, `modprobe` automatically loads any modules it depends on.
    
- When removing a module, `modprobe` removes modules that depend on it, if possible.
    
- Modules can be blacklisted in `/etc/modprobe.d/` configuration files to prevent automatic loading.
    

## Examples

### Load a module

```
modprobe snd_hda_intel
```

This loads the `snd_hda_intel` audio module along with any dependencies.

### Remove a module

```
modprobe -r snd_hda_intel
```

This removes the module from the kernel, provided it is not in use.

### Load multiple modules

```
modprobe -a module1 module2
```

This loads `module1` and `module2` sequentially.

### Show module dependencies without loading

```
modprobe --show-depends snd_hda_intel
```

This displays all dependent modules for `snd_hda_intel`.

### Dry run

```
modprobe -n snd_hda_intel
```

Simulates loading the module, showing what would happen without performing the action.

### Verbose mode

```
modprobe -v snd_hda_intel
```

Displays detailed information about module loading.

### Force load a module

```
modprobe -f some_module
```

Forces the module to load even if warnings or errors occur (use with caution).

### Check if module is blacklisted

```
modprobe --use-blacklist module_name
```

Ensures the module is not loaded if it is listed in the blacklist.

## Related Commands

- `lsmod`: Display loaded kernel modules
    
- `insmod`: Insert a module without handling dependencies
    
- `rmmod`: Remove a module without handling dependencies
    
- `depmod`: Generate module dependency information
    

## Notes

- `modprobe` requires root privileges to load or remove modules.
    
- Configuration files in `/etc/modprobe.d/` allow persistent module settings and blacklisting.
    

* * *

* * *

# `insmod` Command in Linux

## Description

`insmod` is a Linux command used to insert a module into the Linux kernel. Unlike `modprobe`, `insmod` does not resolve module dependencies automatically, so all dependent modules must be loaded manually.

## Syntax

```
insmod [options] module_file
```

- `module_file`: The path to the kernel module file, usually with a `.ko` extension

## Options

- `-f, --force`: Force the insertion of a module, even if it may be unsafe or incompatible (use with caution)
    
- `-v, --verbose`: Display detailed information during module insertion
    
- `--quiet`: Suppress output messages
    
- `--help`: Display help information about the command
    

## Description of Behavior

- `insmod` inserts a single module into the kernel.
    
- It does not check or load dependencies; they must be inserted separately.
    
- Typically used for testing or loading custom modules.
    

## Examples

### Load a kernel module

```
insmod /lib/modules/$(uname -r)/kernel/drivers/sound/snd_hda_intel.ko
```

Loads the `snd_hda_intel` kernel module from the specified path.

### Force load a module

```
insmod -f ./my_module.ko
```

Forces the insertion of `my_module.ko` even if warnings occur.

### Verbose mode

```
insmod -v ./my_module.ko
```

Displays detailed information while loading the module.

### Load multiple modules manually

```
insmod module1.ko
insmod module2.ko
```

Manually load `module1` and `module2` in sequence. Ensure dependencies are resolved manually.

### Verify module is loaded

After inserting a module, check with:

```
lsmod | grep module_name
```

## Related Commands

- `modprobe`: Load modules with automatic dependency resolution
    
- `rmmod`: Remove a module from the kernel
    
- `lsmod`: Display loaded modules
    
- `depmod`: Generate module dependency information
    

## Notes

- `insmod` requires root privileges to insert modules.
    
- Usually used for experimental or custom kernel modules.
    
- Because it does not handle dependencies, errors may occur if required modules are missing.
    

* * *

* * *

# `rmmod` Command in Linux

## Description

`rmmod` is a Linux command used to remove a module from the Linux kernel. Unlike `modprobe -r`, `rmmod` does not automatically remove dependent modules, so the module must not be in use.

## Syntax

```
rmmod [options] module_name
```

- `module_name`: Name of the kernel module to remove

## Options

- `-f, --force`: Force removal of a module even if it is in use or has dependencies (use with caution)
    
- `-v, --verbose`: Display detailed information during module removal
    
- `--quiet`: Suppress output messages
    
- `--help`: Display help information about the command
    

## Description of Behavior

- `rmmod` removes a single module from the kernel.
    
- It does not remove modules that depend on the specified module.
    
- Typically used to unload modules manually or for testing purposes.
    

## Examples

### Remove a kernel module

```
rmmod snd_hda_intel
```

Removes the `snd_hda_intel` kernel module if it is not in use.

### Force removal

```
rmmod -f snd_hda_intel
```

Forces removal of the module even if it is currently in use (use with caution).

### Verbose mode

```
rmmod -v snd_hda_intel
```

Displays detailed information during the removal process.

### Verify module is removed

After removing a module, check with:

```
lsmod | grep snd_hda_intel
```

No output indicates that the module has been successfully removed.

## Related Commands

- `modprobe -r`: Remove modules with automatic dependency handling
    
- `insmod`: Insert a module into the kernel
    
- `lsmod`: Display loaded modules
    
- `depmod`: Generate module dependency information
    

## Notes

- `rmmod` requires root privileges to remove modules.
    
- Use caution when removing modules, as dependent services may fail.
    
- Modules in use by the system or other modules cannot be removed without using the `--force` option.
    

* * *

* * *

# `depmod` Command in Linux

## Description

`depmod` is a Linux command used to generate module dependency information. It scans the kernel modules directory and creates a list of module dependencies, which is used by commands like `modprobe` to load modules correctly.

## Syntax

```
depmod [options] [kernel_version]
```

- `kernel_version`: Optional. Specifies the version of the kernel to process. If omitted, the currently running kernel is used.

## Options

- `-a, --all`: Process all modules (default behavior)
    
- `-b, --basedir <dir>`: Use an alternative base directory for the module tree
    
- `-C, --config <file>`: Use a specific configuration file
    
- `-e, --errsyms`: Warn about undefined symbols
    
- `-F, --symbols-file <file>`: Use a specific file for module symbols
    
- `-n, --dry-run`: Show what would be done without actually writing files
    
- `-v, --verbose`: Provide detailed output
    
- `-h, --help`: Display help information about the command
    

## Description of Behavior

- `depmod` reads the module files from `/lib/modules/<kernel_version>/`.
    
- It generates the `modules.dep` file containing dependency information.
    
- The information is used by `modprobe` to resolve module dependencies automatically.
    
- Running `depmod` is often necessary after installing new modules or upgrading the kernel.
    

## Examples

### Generate dependency information for the current kernel

```
depmod
```

Scans all modules and updates dependency files for the running kernel.

### Generate dependency information for a specific kernel version

```
depmod 5.15.0-70-generic
```

Generates module dependencies for the specified kernel version.

### Verbose output

```
depmod -v
```

Displays detailed information about processing and dependencies.

### Dry run

```
depmod -n
```

Shows what would be done without modifying any files.

### Specify an alternative base directory

```
depmod -b /custom/modules/path
```

Generates dependencies using modules located in a custom directory.

## Related Commands

- `modprobe`: Load modules using dependency information generated by `depmod`
    
- `insmod`: Insert a module manually without dependency resolution
    
- `rmmod`: Remove a module from the kernel
    
- `lsmod`: Display loaded kernel modules
    

## Notes

- `depmod` typically requires root privileges to write dependency files.
    
- Running `depmod` is important after adding, removing, or upgrading kernel modules.
    
- It helps ensure that `modprobe` can automatically resolve and load dependencies correctly.
    

* * *

* * *

# `modinfo` Command in Linux

## Description

`modinfo` is a Linux command used to display detailed information about a kernel module. It provides information such as module version, license, author, parameters, dependencies, and filename.

## Syntax

```
modinfo [options] module_name_or_path
```

- `module_name_or_path`: Name of the module or the path to the module file (usually `.ko` file)

## Options

- `-a, --author`: Display the author of the module
    
- `-d, --description`: Display a short description of the module
    
- `-l, --license`: Show the license of the module
    
- `-p, --parameters`: Show the parameters supported by the module
    
- `-s, --size`: Display the size of the module
    
- `-f, --filename`: Display the full path of the module file
    
- `-r, --version`: Display the version of the module
    
- `-F, --field <fieldname>`: Display only the specified field
    
- `-k, --set-version <kernel>`: Show information for a module built for a specific kernel version
    
- `-n, --numeric`: Show numeric values instead of names where applicable
    
- `-h, --help`: Display help information
    

## Description of Behavior

- `modinfo` extracts module information from the module file itself.
    
- It can be used to verify module details, supported parameters, or licensing before loading the module.
    
- Useful for troubleshooting or inspecting kernel modules.
    

## Examples

### Display information about a module by name

```
modinfo snd_hda_intel
```

Shows detailed information about the `snd_hda_intel` module including version, license, dependencies, parameters, and file location.

### Display information about a module by file path

```
modinfo /lib/modules/$(uname -r)/kernel/drivers/sound/snd_hda_intel.ko
```

Shows detailed information by specifying the full path of the module file.

### Display only author

```
modinfo -a snd_hda_intel
```

Shows the author of the module.

### Display only description

```
modinfo -d snd_hda_intel
```

Shows a brief description of the module.

### Display only license

```
modinfo -l snd_hda_intel
```

Shows the license under which the module is distributed.

### Display module parameters

```
modinfo -p snd_hda_intel
```

Lists the parameters that can be passed to the module when loaded.

### Display module version

```
modinfo -r snd_hda_intel
```

Shows the version of the module.

### Display full filename

```
modinfo -f snd_hda_intel
```

Shows the full path of the module file.

### Display a specific field

```
modinfo -F license snd_hda_intel
```

Shows only the license field of the module.

## Related Commands

- `lsmod`: List currently loaded kernel modules
    
- `modprobe`: Load modules with dependency handling
    
- `insmod`: Insert modules manually
    
- `rmmod`: Remove modules from the kernel
    
- `depmod`: Generate module dependency information
    

## Notes

- `modinfo` does not modify the system; it is read-only.
    
- Can be used with root or regular user privileges since it only reads module information.
    
- Useful for validating modules before loading or troubleshooting issues with kernel modules.
    

* * *

* * *

